<!DOCTYPE html>
<html lang="en">
	<head>
		<title>What's Happening In Patterson Park</title>
		<!-- Bootstrap -->
		<link href="css/bootstrap.min.css" rel="stylesheet">
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-12067009-4']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
	</head>
	
	<body>
		<script src="js/jquery-1.8.1.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script type="text/javascript">
		// GLOBALS
		//major festivals in the Park area - //NOT USED YET --- var instaFestivals = [''34758714','20203946',]
		//'34480183':BSSC Football,'1085877':ice rink,'18870116':baltimore bocce,'2833987':utz field,'18986673':PattersonPark Bocce
		var instaLocations = ['76385','76376','3675624','3618223','2300010','91429','5369637','11110077','10537008'];
		var allInstagram = [];
		var allInstagramHtml = [];


		function outputStatusTable(className, itemsList, divId){
			$('<table/>', {
				'class': 'table table-striped table-hover '+className,
				html: itemsList.join('')
			}).appendTo(divId);
		}

		function compare(a,b) {
			if (a.time > b.time)
				return -1;
			if (a.time < b.time)
 				return 1;
  			return 0;
		}
		
		function getFacebook(){
			//Searches all public status updates, gets the link if there is one.
			//Want to expand to pages that represent Patterson Park area (PPNA, Dog Park, BSSC)
			$.getJSON('https://graph.facebook.com/search?q=%22Patterson%20Park%22&type=post&limit=25', function(json) {
				var facebookItems = [];
				$.each(json.data, function(i){
					var post = {};
					post.id = this.id;
					post.name = this.from.name;
					post.type = this.type;
					
					if(post.type == 'status') {
						post.message = this.message;	
						facebookItems.push('<tr><td><font color="#F7951E">'+post.name+'</font> - "'+post.message+'"</td></tr>'); 
					}
					if(post.type == 'link') {
						post.link = this.link;
						post.linkName = this.name;
						post.linkDescription = this.description;
						post.message = this.message;
						if(post.message){
							facebookItems.push('<tr><td><font color="#F7951E">'+post.name+'</font> - "'+post.message+' - <a href="'+post.link+'" title="'+post.linkDescription+'">'+post.linkName+'</a>"</td></tr>');
						}else{
							facebookItems.push('<tr><td><font color="#F7951E">'+post.name+'</font> - "<a href="'+post.link+'" title="'+post.linkDescription+'">'+post.linkName+'</a>"</td></tr>');
						}
					}
					 
				});
				outputStatusTable('facebookStatusList', facebookItems, '#facebookStatus');
			});
		}
		
		function getTwitter(){
			//Searches all public tweets for "Patterson Park" or "#dontpavethepark" or geocoded from center of park 39.289095,-76.58025,1km
			$.getJSON('http://search.twitter.com/search.json?callback=?&q=%22Patterson%20Park%22%20OR%20#dontpavethepark%20OR%20geocode=39.289095,-76.580256,1km&result_type=recent', function(json) {
				var twitterItems = [];
				$.each(json.results, function(i){
					var post = {};
					post.date = this.created_at;
					post.userId = this.from_user;
					post.userName = this.from_user_name
					post.text = this.text;
					post.id = this.id;
					
					twitterItems.push('<tr><td><a href="http://twitter.com/'+post.userId+'" style="color:#F7951E">'+post.userName+'</a> - "'+post.text+'" -'+post.date+'</td></tr>');
				});
				outputStatusTable('twitterStatusList', twitterItems, '#twitterStatus');
			});
		}

		function getInstagram(locations){
			//Searches all public posts that are tagged with Foursquare locations in the park.
			//For this version I decided to just get their Instagram ids and not actually dynamically set them by calling foursquare first and then find them on instagram, too much IO
			
			var urlBase = 'https://api.instagram.com/v1/locations/';
			var urlEnd = '/media/recent?callback=?&client_id=71dc961673584243984089d5edf3da4a';
			var doneRequests = 0;

			if(locations.length > 0){
				//Call all the current top location
				$.getJSON(urlBase+locations[0]+urlEnd, function(json){
					$.each(json.data, function(i){
						var gram = {};
						gram.id = this.id;
						//gram.userId = this.user.username;	//rather have real names
						gram.userName = this.user.full_name;
						gram.image = this.images.low_resolution.url;
						gram.imageLink = this.link;
						gram.time = this.created_time;

						if(this.caption){
							gram.caption = this.caption.text;
						}else{
							gram.caption = "";
						}
						allInstagram.push(gram);
					});
					locations.shift();		//removes the item we just used
					getInstagram(locations);	//pass updated list	
				});
			}else{
				allInstagram.sort(compare);
				$.each(allInstagram, function(i){
					allInstagramHtml.push('<tr><td><a href="'+this.imageLink+'" style="color:#F7951E">'+this.userName+' - '+this.caption+'<br><img src="'+this.image+'"></a></td></tr>');
				});
				outputStatusTable('instagramStatusList', allInstagramHtml, '#instagramStatus');
			}			
		}

		$(document).ready(function(){
			// Get status updates and locations on load
			getFacebook();
			getInstagram(instaLocations)
			getTwitter();
		});
		</script>

		<h1>Save Patterson Park</h1><br>

		<div class="row-fluid show-grid">
			<div class="span12">
				<div class="span8">
					<p class="lead">Dear Mayor Rawlings-Blake,<br>
					Before deciding to do irreparable harm to Patterson Park and the livelihood of the surrounding communities please take a look at the everyday life taking place in the Park. 
					This expanded parking and senior center will truly harm the best greenspace in all of Baltimore. I truly hope these social media posts 
					<br><br>Please keep our Park green and free of cars!
					<br><br>If you want to get involved please attend the meetings and sign the petition to the right.
				</div>
				<div class="span4">
					<div class="row-fluid">
						<div class="span4">
							<h4>Links</h4>
							<small>
							<a href="http://www.change.org/petitions/baltimore-city-s-department-of-recreation-and-parks-and-health-department-don-t-pave-the-park">Don't Pave the Park Petition</a><br>
							<a href="http://www.facebook.com/pages/Patterson-Park-Help-Stop-The-Paving-Of-Our-Beautiful-Park/158174660986894?ref=stream">Patterson Park Help Stop The Paving Of Our Beautiful Park - Facebook Page</a><br>
							<a href="http://pattersonparkneighbors.org/">Patterson Park Neighborhood Association</a><br>
							<a href="http://www.fellsprospect.org/">Fells Prospect</a><br>
							<a href="http://www.butchershill.org/">Butchers Hill</a><br>
							<a href="http://www.pattersonpark.com/">Friends of Patterson Park</a><br>
							</small>
						</div>
						<div class="span4">
							<h5>Community Meetings</h5>
							<small>
							<ol>
								<li>Monday, October 1st, 6:30-8:00pm at Virginia Baker Rec Center in Patterson Park</li>
								<li>Saturday, October 6th, 10:30am-12:00pm at Hampstead Hill Academy, 500 S. Linwood Ave.</li>
								<li>Tuesday, October 9th, 7:00-8:30pm at St. Andrew’s Church, 2028 E. Lombard St.</li>
								<li>Thursday, October 11th, 7:30-9:00 pm at Breath of God Lutheran Church, 141 S. Clinton St.</li>
							</ol>
							</small>
						</div>
						<div class="span4">
							<h4>About</h4>
							<small>
								I'm a resident of Patterson Park. When I'm not <a href="http://www.ebrianschneider.com">photographing</a> or working on other entrepreneurial projects, I'm spending time with my wife restoring our 104 yr old home and playing with our yellow-lab Annie.<br>Contact <a href="mailto:brian@ebrianschneider.com">brian@ebrianschneider.com</a>
							</small>
						</div>
					</div>
				</div>
			</div>
		</div>
		<br>
		<div class="row-fluid show-grid">
			<div class="span12">
				<div class="row-fluid show-grid" id="statusHeaders" style="color:white; background-color:#762A8B; margin-bottom:10px">
					<div class="span4"><h4>Facebook</h4>
						All public posts currently mentioning Patterson Park or mobile ones that have GPS locations within the park.<br>
					</div>
					<div class="span4"><h4>Twitter</h4>
						All public tweets mention Patterson Park, #dontpavethepark, or have GPS locations within the park.<br>
					</div>
					<div class="span4"><h4>Instagram</h4>
						All public images posted and tagged to different locations around the park (Pool, Pagoada, Duck Pond) and the Park itself.<br>
					</div>
				</div>
				<div class="row-fluid show-grid" id="status">
					<div class="span4" id="facebookStatus"></div>					
					<div class="span4" id="twitterStatus"></div>
					<div class="span4" id="instagramStatus"></div>
				</div>
			</div>
		</div>
		<div align="center"><a href="http://madewithloveinbaltimore.org">Made with &hearts; in Baltimore</a></div>
	</body>
</html>
